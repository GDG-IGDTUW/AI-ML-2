import pandas as pd
from sklearn.model_selection import train_test_split


def stratified_train_test_split(
    csv_path,
    label_column="label",
    test_size=0.2,
    random_state=42,
    output_dir="splits"
):
    """
    Performs a stratified, reproducible train-test split
    while preventing data leakage.
    """

    # Load dataset
    df = pd.read_csv(csv_path)

    # Separate features and labels
    X = df.drop(columns=[label_column])
    y = df[label_column]

    # Stratified split
    X_train, X_test, y_train, y_test = train_test_split(
        X,
        y,
        test_size=test_size,
        stratify=y,
        random_state=random_state
    )

    # Recombine for clean datasets
    train_df = X_train.copy()
    train_df[label_column] = y_train

    test_df = X_test.copy()
    test_df[label_column] = y_test

    # Save outputs
    train_path = f"{output_dir}/train.csv"
    test_path = f"{output_dir}/test.csv"

    train_df.to_csv(train_path, index=False)
    test_df.to_csv(test_path, index=False)

    print("âœ… Stratified split completed")
    print(f"Train shape: {train_df.shape}")
    print(f"Test shape: {test_df.shape}")

    return train_path, test_path
